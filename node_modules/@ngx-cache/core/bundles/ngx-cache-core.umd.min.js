!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("rxjs"),require("rxjs/operators"),require("events")):"function"==typeof define&&define.amd?define("@ngx-cache/core",["exports","@angular/core","rxjs","rxjs/operators","events"],t):t((e["ngx-cache"]=e["ngx-cache"]||{},e["ngx-cache"].core={}),e.ng.core,e.rxjs,e.rxjs.operators,e.events)}(this,function(e,r,d,v,t){"use strict";var m,n,o=function l(){},i=function(){function e(e){void 0===e&&(e={key:"NGX_CACHE",lifeSpan:{expiry:Number.MAX_VALUE,TTL:Number.MAX_VALUE}}),this.providedSettings=e}return Object.defineProperty(e.prototype,"key",{get:function(){return this.providedSettings.key},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lifeSpan",{get:function(){return this.providedSettings.lifeSpan},enumerable:!0,configurable:!0}),e}();(n=m||(m={}))[n.Scalar=0]="Scalar",n[n.Observable=10]="Observable",n[n.Promise=20]="Promise";var a=new r.InjectionToken("CACHE"),g=function(){function i(e,t,r){this.loader=e,this.platformId=t,this.injector=r,(i.instance=this).cache=this.injector.get(a),this.lifeSpan=e.lifeSpan}return i.getInstance=function(e,t,r){return i.instance},i.normalizeKey=function(e){if(i.validateKey(e))throw new Error("Please provide a valid key to save in the CacheService");return""+e},i.validateKey=function(e){return!e||"boolean"==typeof e||Number.isNaN(e)},i.validateValue=function(e){return e.lifeSpan.expiry&&e.lifeSpan.expiry>Date.now()},Object.defineProperty(i.prototype,"key",{get:function(){return this.loader.key},enumerable:!0,configurable:!0}),i.prototype.has=function(e){var t=i.normalizeKey(e);return-1!==this.cache.keys.indexOf(t)},i.prototype.set=function(e,t,r,n){void 0===r&&(r=m.Scalar);var o=i.normalizeKey(e);return this.cache.setItem(o,{data:t,returnType:r,lifeSpan:this.parseLifeSpan(n||this.lifeSpan)})},i.prototype.get=function(e){var t=i.normalizeKey(e),r=this.cache.getItem(t);if(r){if(i.validateValue(r))return r.data;this.remove(t)}return undefined},i.prototype.getWithMetadata=function(e){var t=i.normalizeKey(e),r=this.cache.getItem(t);if(r){if(i.validateValue(r))return r;this.remove(e)}return undefined},i.prototype.remove=function(e,t){void 0===t&&(t=!1);var r=i.normalizeKey(e);this.cache.removeItem(r,t)},i.prototype.clear=function(){this.cache.clear()},i.prototype.dehydrate=function(){var t=this,e=this.cache.keys.length?this.cache.keys:[],r={};return e.forEach(function(e){r[e]=t.cache.getItem(e)}),r},i.prototype.rehydrate=function(r){var n=this;Object.keys(r).forEach(function(e){var t=i.normalizeKey(e);n.cache.setItem(t,r[t])})},i.prototype.parseLifeSpan=function(e){return{expiry:e.expiry||(e.TTL?Date.now()+1e3*e.TTL:this.lifeSpan.expiry),TTL:e.TTL||this.lifeSpan.TTL}},i.instance=undefined,i.decorators=[{type:r.Injectable}],i.ctorParameters=function(){return[{type:o},{type:undefined,decorators:[{type:r.Inject,args:[r.PLATFORM_ID]}]},{type:r.Injector}]},i}(),c=function S(){};var u=function(e,t){return(u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)};var s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return function n(e,t){function r(){this.constructor=e}u(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}(t,e),t}(t.EventEmitter),f=new r.InjectionToken("STORAGE");function p(){return new i}function y(e,t,r){return new g(e,t,r)}var h=function(){function t(e){if(e)throw new Error("CacheModule already loaded; import in root module only.")}return t.forRoot=function(e){return void 0===e&&(e={provide:o,useFactory:p}),{ngModule:t,providers:[e,{provide:g,useFactory:y,deps:[o,r.PLATFORM_ID,r.Injector]}]}},t.decorators=[{type:r.NgModule}],t.ctorParameters=function(){return[{type:t,decorators:[{type:r.Optional},{type:r.SkipSelf}]}]},t}();e.STORAGE=f,e.cacheFactory=p,e.cacheServiceFactory=y,e.CacheModule=h,e.Cache=c,e.CacheLoader=o,e.CacheStaticLoader=i,e.CACHE=a,e.CacheService=g,e.CacheKey=function b(e,t,r){var n="__cache_"+t+"_keys";Array.isArray(e[n])?e[n].push(r):e[n]=[r]},e.Cached=function _(l){return function(p,y,e){var h=e.value;return e.value=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=g.getInstance(),n=p["__cache_"+y+"_keys"],o="";if(Array.isArray(n))for(var i=0;i<e.length;i++)-1!==n.indexOf(i)&&(o=o?o+"_"+String(e[i]):String(e[i]));var a=o?l+"_"+o:l;if(a=g.normalizeKey(a),!r||!a)return h.apply(this,e);if(r.has(a)){var c=r.getWithMetadata(a);if(c&&c.data)switch(c.returnType){case m.Observable:return d.of(c.data);case m.Promise:return Promise.resolve(c.data);default:return c.data}}var u,s,f=h.apply(this,e);return(s=f)&&"function"==typeof s.subscribe?f.pipe(v.map(function(e){return r.set(a,e,m.Observable),e})):(u=f)&&"function"==typeof u.then?f.then(function(e){return r.set(a,e,m.Promise),e}):(r.set(a,f),f)},e}},e.Storage=s,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=ngx-cache-core.umd.min.js.map